# ç¬”è®°

## Vuex çŠ¶æ€ç®¡ç†

### ç»„ä»¶çš„ä¼ å€¼æ–¹å¼

1. çˆ¶å­ç»„ä»¶ä¼ å€¼: props
2. å­çˆ¶ç»„ä»¶ä¼ å€¼: props + å›è°ƒ
3. ä¸ç›¸å¹²ç»„ä»¶ä¼ å€¼: eventbus

### Vuex æ ¸å¿ƒæ¦‚å¿µ

#### Vuex ä¸å…¨å±€å¯¹è±¡çš„åŒºåˆ«

1. vuex ä¸­çš„çŠ¶æ€æ˜¯å“åº”å¼çš„ï¼Œä¿®æ”¹ vuex çŠ¶æ€ä¼šæ›´æ–°å¯¹åº”çš„ç»„ä»¶
2. vuex çš„çŠ¶æ€åªèƒ½é€šè¿‡ mutation è¿›è¡Œä¿®æ”¹ï¼Œ æ–¹ä¾¿çŠ¶æ€è·Ÿè¸ª

> æˆ‘ä»¬é€šè¿‡æäº¤ mutation çš„æ–¹å¼ï¼Œè€Œéç›´æ¥æ”¹å˜ store.state.countï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æƒ³è¦æ›´æ˜ç¡®åœ°è¿½è¸ªåˆ°çŠ¶æ€çš„å˜åŒ–ã€‚è¿™ä¸ªç®€å•çš„çº¦å®šèƒ½å¤Ÿè®©ä½ çš„æ„å›¾æ›´åŠ æ˜æ˜¾ï¼Œè¿™æ ·ä½ åœ¨é˜…è¯»ä»£ç çš„æ—¶å€™èƒ½æ›´å®¹æ˜“åœ°è§£è¯»åº”ç”¨å†…éƒ¨çš„çŠ¶æ€æ”¹å˜ã€‚æ­¤å¤–ï¼Œè¿™æ ·ä¹Ÿè®©æˆ‘ä»¬æœ‰æœºä¼šå»å®ç°ä¸€äº›èƒ½è®°å½•æ¯æ¬¡çŠ¶æ€æ”¹å˜ï¼Œä¿å­˜çŠ¶æ€å¿«ç…§çš„è°ƒè¯•å·¥å…·ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å®ç°å¦‚æ—¶é—´ç©¿æ¢­èˆ¬çš„è°ƒè¯•ä½“éªŒã€‚

#### State

State åŒ…å«äº†å…¨éƒ¨çš„åº”ç”¨çº§åˆ«çš„çŠ¶æ€ï¼Œæ¯ä¸ªåº”ç”¨åªåŒ…å«ä¸€ä¸ª store, å•ä¸€æ•°æ®æºåŸåˆ™ SSOT, å•ä¸€çŠ¶æ€æ ‘èƒ½å¤Ÿå¿«æ·ç‚¹å®šä¹‰ä»»æ„ä¸€ä¸ªçŠ¶æ€åˆ¤æ–­ï¼Œèƒ½å¤Ÿæ›´è½»æ¾çš„è·å–æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€å¿«ç…§

Store çš„çŠ¶æ€æ˜¯å“åº”å¼çš„ï¼Œé€šè¿‡ store æ³¨å…¥åˆ°æ¯ä¸€ä¸ª Vue çš„ç»„ä»¶å®ä¾‹ä¸­

mapState è¾…åŠ©å‡½æ•°èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆè®¡ç®—å±æ€§ï¼Œå‡å°‘é‡å¤ä»£ç 

ä¸¥æ ¼å±äºæŸä¸ªç»„ä»¶çš„çŠ¶æ€ï¼Œä¾ç„¶æ”¾åœ¨ç»„ä»¶çš„å±€éƒ¨çŠ¶æ€ä¸­

#### Getter

getter å’Œè®¡ç®—å±æ€§ä¸€æ ·ï¼Œä»–ä¼šæ ¹æ®ä¾èµ–é¡¹ç¼“å­˜æ±‚å€¼ï¼Œå½“ä¾èµ–é¡¹æ”¹å˜åä¼šé‡æ–°æ±‚å€¼

#### Mutation

Mutation æ˜¯æ•´ä¸ª Store å”¯ä¸€èƒ½ä¿®æ”¹çŠ¶æ€çš„åœ°æ–¹ï¼Œå¹¶ä¸”å¯¹åº”çš„å¤„ç†æ–¹æ³•å¿…é¡»æ˜¯åŒæ­¥çš„ï¼Œè¿™æ · devtool æ‰èƒ½è·Ÿè¸ªåˆ°çŠ¶æ€çš„å˜åŒ–å‰åã€‚

### Action

Action ç±»ä¼¼ Mutation, ä½†æ˜¯ Action ä¸èƒ½ç›´æ¥ä¿®æ”¹ state, åªèƒ½é€šè¿‡ commit æäº¤ç»™ Mutation è¿›è¡Œä¿®æ”¹ï¼Œ Action ä¸­å¯ä»¥æ˜¯å¼‚æ­¥çš„æ“ä½œ

### ç®€å•å®ç° Vuex

```javascript
export default class SampleVuex {
  static install(Vue) {
    _Vue = Vue
    Vue.mixin({
      beforeCreate() {
        if (this.$parent) {
          this.$store = this.$parent.$store
          return
        }
        this.$store = this.$options.store
      },
    })
  }

  static Store = class Store {
    constructor(options) {
      console.dir(_Vue)
      this.state = _Vue.observable(options.state || {})

      this.mutations = options.mutations || {}

      this.actions = options.actions || {}

      this.getters = new Proxy(options.getters || {}, {
        get(context, key) {
          const handler = Reflect.get(context, key)
          if (typeof handler !== 'function') {
            return handler
          }
          return handler(this.state)
        },
        set() {
          throw new Error('getter cannot set')
        },
      })
    }

    dispatch(type, payload) {
      this.actions[type](this, payload)
    }

    commit(type, payload) {
      this.mutations[type](this.state, payload)
    }
  }
}
```

## SSR åŸºç¡€

### æœåŠ¡ç«¯æ¸²æŸ“åŸºç¡€

![](../pictures/server-side-render.webp)

### æœåŠ¡ç«¯æ¸²æŸ“ä¼˜åŠ¿

1. åˆ©äº SEO
2. é¦–å±æ˜¾ç¤ºæ•ˆç‡æ›´å¿«

### æœåŠ¡ç«¯æ¸²æŸ“çš„é—®é¢˜

1. å‰åç«¯ä»£ç å®Œå…¨è€¦åˆåœ¨ä¸€èµ·ï¼Œä¸åˆ©äºå¼€å‘ç»´æŠ¤
2. å‰ç«¯æ²¡æœ‰è¶³å¤Ÿçš„å¼€å‘ç©ºé—´
3. æœåŠ¡ç«¯å‹åŠ›å¤§
4. ç”¨æˆ·ä½“éªŒä¸€èˆ¬

## Nuxt åŸºç¡€

Nuxt æ˜¯ä¸€å¥—åŸºäº Vue çš„é€šç”¨æ¡†æ¶ï¼Œæ”¯æŒæ”¯æŒå®¢æˆ·ç«¯æ¸²æŸ“ï¼Œä¸åŒæ„æ¸²æŸ“ã€‚ä»¥ä¸‹æ˜¯å®ƒçš„ç‰¹ç‚¹ï¼š

1. åŸºäº Vue.js
2. è‡ªåŠ¨ä»£ç åˆ†å±‚
3. æœåŠ¡ç«¯æ¸²æŸ“
4. å¼ºå¤§çš„è·¯ç”±åŠŸèƒ½ï¼Œæ”¯æŒå¼‚æ­¥æ•°æ®
5. é™æ€æ–‡ä»¶æœåŠ¡
6. ES6+ æ”¯æŒ
7. æ‰“åŒ…å‹ç¼©
8. å¤´éƒ¨æ ‡ç­¾ç®¡ç†
9. çƒ­æ›´æ–°
10. æ”¯æŒ HTTP/2 ç­‰

Nuxt åŸºäºç›®å½•çº¦å®šçš„å½¢å¼ä¸ºä¸ºä»£ç åˆ†å±‚ã€‚

1. assets èµ„æºç›®å½•
2. components ç»„ä»¶
3. layouts å¸ƒå±€ç»„ä»¶
4. middleware ä¸­é—´ä»¶
5. pages é¡µé¢ï¼Œæ¯ä¸€ä¸ªç›®å½•ä»£è¡¨ä¸€ä¸ªè·¯ç”±
6. plugins æ’ä»¶
7. static é™æ€èµ„æºç›®å½•
8. store Vuex ç›®å½•ç­‰

### Nuxt è·¯ç”±

Nuxt çš„è·¯ç”±é»˜è®¤ä» pages åº•ä¸‹è·å–ï¼Œpages ä¸‹æ¯ä¸€ä¸ªç›®å½•ä¼šè¢«ç”Ÿæˆä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œä¹Ÿå¯ä»¥åœ¨ nuxt.config.js ä¸­é€šè¿‡ router.extendRoutes æ‰‹åŠ¨å¤„ç†è·¯ç”±

### Nuxt AsyncData

å¼‚æ­¥æ•°æ®åœ¨é¡µé¢ç»„ä»¶æ¸²æŸ“å‰æ‰§è¡Œï¼Œä»–ä¼šåœ¨æœåŠ¡ç«¯æˆ–è€…è·¯ç”±æ›´æ–°å‰è¢«è°ƒç”¨ï¼Œç”±äº asyncData èƒ½åœ¨æœåŠ¡ç«¯è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒä¸èƒ½æ ¹æ® this è®¿é—®åˆ° vue å®ä¾‹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•° context å¯ä»¥è·å–åˆ°å½“å‰è¯·æ±‚çš„ä¸€äº›å‚æ•°ã€‚
æœ€ç»ˆè¿”å›çš„å€¼ä¼šä¸é€šè¿‡ data è®¾ç½®çš„æ•°æ®èåˆã€‚

### Nuxt ä¸Šä¸‹æ–‡

asyncData ä¸­çš„ä¸Šä¸‹æ–‡å¯¹è±¡åŒ…å«äº†æ•´ä¸ªè¯·æ±‚çš„æ‰€æœ‰çŠ¶æ€ï¼ŒåŒ…æ‹¬è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€å“åº”è¡Œã€å“åº”å¤´ç­‰

### å¼‚å¸¸å¤„ç†

é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼å¤„ç†å¼‚å¸¸æƒ…å†µï¼š

1. ä½¿ç”¨ Nuxt é»˜è®¤çš„å¼‚å¸¸é¡µé¢
   1. é€šè¿‡ nuxt ä¸Šä¸‹æ–‡ä¸­çš„ error å‡½æ•°å°†é”™è¯¯ä¿¡æ¯æŠ›ç»™å¼‚å¸¸é¡µé¢
   2. é€šè¿‡ AsyncData çš„ç¬¬äºŒä¸ªå‚æ•° callback å°†å¼‚å¸¸æƒ…å†µæŠ›ç»™å¼‚å¸¸é¡µé¢
1. æ‰‹åŠ¨ catch æ¥ç®¡å¼‚å¸¸å¤„ç†

### ç™»é™†æµç¨‹

1. é¦–æ¬¡ç™»é™†åï¼Œå°† token è®¾ç½®åˆ° cookie ä¸­å¹¶ä¸”ä¿å­˜åœ¨ store ä¸­ï¼Œä¹‹åå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½è·å– token å¸¦ä¸Š
2. å†æ¬¡æ‰“å¼€é¡µé¢åï¼Œç”±äº token è®¾ç½®åœ¨ cookie ä¸­ï¼Œæ‰€ä»¥æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™å¯ä»¥æ ¹æ®è¯·æ±‚å¤´ä¸­å¸¦ä¸Šçš„ cookie è®¾ç½®ç™»é™†çŠ¶æ€
   1. é€šè¿‡ store çš„ nuxtServerInit store åœ¨æœåŠ¡ç«¯çš„åˆå§‹åŒ–é€»è¾‘
   2. é€šè¿‡ req è·å–åˆ°è¯·æ±‚å¤´ä¸Šçš„ cookie
   3. å°† cookie è§£æå¹¶ä¸”é€šè¿‡ commit æäº¤åˆ° store ä¸­

### è¯·æ±‚å¤„ç†

ç”±äºæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å¸¦ä¸Šç”¨æˆ·çš„ Tokenï¼Œ è·å–è¯·æ±‚å‰éœ€è¦æå‰è·å–åˆ°ï¼Œç”±äº cookie/storage ç­‰éƒ½æ˜¯å®¢æˆ·ç«¯çš„ API ä¸é€‚ç”¨æœåŠ¡ç«¯æ¸²æŸ“çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦ä»ä¸¤ç«¯éƒ½æ”¯æŒçš„ store ä¸­è·å– token  
å¯ä»¥é€šè¿‡ nuxt æä¾›çš„ plugins è¯»å–åˆ° storeï¼Œ åœ¨åˆ©ç”¨ axios çš„æ‹¦æˆªå™¨è®¾ç½® store ä¸­çš„ token

#### å¹¶å‘è¯·æ±‚

å¹¶å‘è¯·æ±‚å¯ä»¥ä½¿ç”¨ Promise.all æˆ–è€… Promise.allSellet å®ç°

### è‡ªåŠ¨éƒ¨ç½²

åˆ©ç”¨ Github Action

```yaml
name: Deploy To Vercel

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout ğŸ¤
        uses: actions/checkout@v2

      - name: Setup node ğŸ¤Ÿ
        uses: actions/setup-node@v1
        with:
          node-version: 12.x

      - name: Build Project ğŸ‘Œ
        run: npm install && npm run build

      - name: Deploy ğŸ¤
        run: npx vercel --token=${{ secrets.ACCESS_TOKEN }} --confirm  --prod
```
